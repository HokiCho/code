<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë°”ì¼ ë°”ì½”ë“œ</title>
    
    <!-- ë³´ì•ˆ í—¤ë”ë“¤ -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://unpkg.com;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        connect-src 'self' https://apuvfmnwocpnfksowinh.supabase.co;
        font-src 'self';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- PWA ë©”íƒ€íƒœê·¸ -->
    <meta name="theme-color" content="#764ba2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ìš°ë¦¬ì§‘ë°”ì½”ë“œ">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- ì•„ì´ì½˜ë“¤ -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512x512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    <link rel="shortcut icon" href="/icons/icon-192x192.png">
    
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
/* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
}

.container {
    max-width: 500px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* í—¤ë” */
header {
    text-align: center;
    margin-bottom: 30px;
    color: white;
}

header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* ì„¹ì…˜ */
.section {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    margin-bottom: 20px;
}

/* í¼ ìŠ¤íƒ€ì¼ */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #555;
}

.form-group input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s ease;
}

.form-group input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* ë²„íŠ¼ */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-1px);
}

.btn-copy {
    background: #28a745;
    color: white;
    padding: 8px 16px;
    font-size: 14px;
}

.btn-copy:hover {
    background: #218838;
}

/* ìƒˆë¡œê³ ì¹¨ ì„¹ì…˜ */
.refresh-section {
    margin-top: 30px;
}

.refresh-section button {
    margin: 5px;
}

#request-new-barcode {
    background: #fd7e14;
}

#request-new-barcode:hover {
    background: #e8590c;
    transform: translateY(-1px);
}

.last-updated {
    margin-top: 15px;
    font-size: 14px;
    color: #6c757d;
}

/* ì—ëŸ¬ ë©”ì‹œì§€ */
.error-message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #dc3545;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
    z-index: 1000;
    max-width: 90%;
    text-align: center;
}

/* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ì€ ë™ì¼ */
.auth-links {
    text-align: center;
    margin-top: 20px;
}

.auth-links a {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
}

.user-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f8f9fa;
}

.barcode-container {
    text-align: center;
}

.barcode-info {
    margin-bottom: 25px;
}

.barcode-info h3 {
    font-size: 1.5rem;
    margin-bottom: 15px;
    color: #333;
}

.barcode-meta {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
}

.time-info, .expires-info {
    background: #e9ecef;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
}

.time-info {
    color: #28a745;
}

.time-info.warning {
    color: #ffc107;
    background: #fff3cd;
    animation: pulse 1s infinite;
}

.time-info.expired {
    color: #dc3545;
    background: #f8d7da;
}

.expires-info {
    color: #dc3545;
}

.expires-info.warning {
    color: #ffc107;
    background: #fff3cd;
    animation: pulse 1s infinite;
}

.expires-info.expired {
    color: #dc3545;
    background: #f8d7da;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.barcode-image-container {
    background: white;
    border: 3px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin: 25px 0;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.barcode-image-container img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
}

.barcode-number {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    margin: 25px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
}

.barcode-number p {
    font-family: 'Courier New', monospace;
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
    letter-spacing: 2px;
    margin: 0;
}

.loading {
    text-align: center;
    padding: 40px 20px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.no-data {
    text-align: center;
    padding: 40px 20px;
}

.no-data h3 {
    color: #6c757d;
    margin-bottom: 15px;
}

.no-data p {
    color: #6c757d;
    margin-bottom: 25px;
}

footer {
    text-align: center;
    color: white;
    opacity: 0.8;
    margin-top: auto;
    padding: 20px 0;
}

@media (max-width: 480px) {
    .container {
        padding: 15px;
    }
    
    header h1 {
        font-size: 2rem;
    }
    
    .section {
        padding: 20px;
    }
    
    .barcode-meta {
        flex-direction: column;
        align-items: center;
    }
    
    .barcode-number {
        flex-direction: column;
        text-align: center;
    }
    
    .user-info {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ  ìš°ë¦¬ì§‘ë°”ì½”ë“œ</h1>
            <p>ì‹¤ì‹œê°„ ëª¨ë°”ì¼ ë°”ì½”ë“œ ì¡°íšŒ</p>
            <button id="install-pwa" class="btn btn-secondary" style="display: none; position: absolute; top: 15px; right: 15px;">
                ğŸ“± ì•± ì„¤ì¹˜
            </button>
        </header>

        <!-- ë¡œê·¸ì¸ í¼ -->
        <div id="login-section" class="section">
            <div class="login-form">
                <h2>ë°”ì½”ë“œ ì¡°íšŒ ë¡œê·¸ì¸</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="email">ì‚¬ìš©ì ID</label>
                        <input type="text" id="email" required placeholder="ì‚¬ìš©ì ID ì…ë ¥">
                    </div>
                    <div class="form-group">
                        <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="password" required placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    </div>
                    <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                </form>
                
                <div class="auth-links">
                    <p>ğŸ”’ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ë°”ì½”ë“œ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
                    <p style="font-size: 12px; color: #dc3545; font-style: italic;">ë³´ì•ˆì„ ìœ„í•´ ë¡œê·¸ì¸ ì •ë³´ëŠ” ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>

        <!-- ë°”ì½”ë“œ í‘œì‹œ ì„¹ì…˜ -->
        <div id="barcode-section" class="section" style="display: none;">
            <div class="user-info">
                <span id="user-email"></span>
                <button id="logout-btn" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</button>
            </div>

            <div class="barcode-container">
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>ë°”ì½”ë“œ ë¡œë”© ì¤‘...</p>
                </div>

                <div id="barcode-display" style="display: none;">
                    <div class="barcode-info">
                        <h3>í˜„ì¬ ë°”ì½”ë“œ</h3>
                        <div class="barcode-meta">
                            <span id="barcode-time" class="time-info"></span>
                            <span id="barcode-expires" class="expires-info"></span>
                        </div>
                    </div>

                    <div class="barcode-image-container">
                        <img id="barcode-image" alt="ëª¨ë°”ì¼ ë°”ì½”ë“œ" />
                    </div>

                    <div class="barcode-number">
                        <p id="barcode-number-display"></p>
                        <button id="copy-barcode" class="btn btn-copy">ë³µì‚¬</button>
                    </div>

                    <div class="refresh-section">
                        <button id="refresh-barcode" class="btn btn-primary">ğŸ“± ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
                        <button id="request-new-barcode" class="btn btn-secondary" style="display: none;">ğŸ”„ ìƒˆ ë°”ì½”ë“œ ìš”ì²­</button>
                        <p class="last-updated">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-updated-time"></span></p>
                    </div>
                </div>

                <div id="no-barcode" style="display: none;">
                    <div class="no-data">
                        <h3>ë°”ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ì•„ì§ ìˆ˜ì§‘ëœ ë°”ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                        <button id="retry-barcode" class="btn btn-primary">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div id="error-message" class="error-message" style="display: none;">
            <p id="error-text"></p>
            <button id="close-error" class="btn btn-secondary">ë‹«ê¸°</button>
        </div>
    </div>

    <footer>
    </footer>

    <script>
        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://apuvfmnwocpnfksowinh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwdXZmbW53b2NwbmZrc293aW5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3ODA0NTksImV4cCI6MjA2NTM1NjQ1OX0.qlDKkIt-fSWtmpD3gvBE20aZOKpWjDmk37iz28ijTQM';

        // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // DOM ìš”ì†Œë“¤
        const loginSection = document.getElementById('login-section');
        const barcodeSection = document.getElementById('barcode-section');
        const loginForm = document.getElementById('login-form');
        const logoutBtn = document.getElementById('logout-btn');
        const userIdSpan = document.getElementById('user-email');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const closeErrorBtn = document.getElementById('close-error');

        // ë°”ì½”ë“œ ê´€ë ¨ ìš”ì†Œë“¤
        const loading = document.getElementById('loading');
        const barcodeDisplay = document.getElementById('barcode-display');
        const noBarcodeDiv = document.getElementById('no-barcode');
        const barcodeImage = document.getElementById('barcode-image');
        const barcodeNumberDisplay = document.getElementById('barcode-number-display');
        const barcodeTime = document.getElementById('barcode-time');
        const barcodeExpires = document.getElementById('barcode-expires');
        const lastUpdatedTime = document.getElementById('last-updated-time');
        const refreshBarcodeBtn = document.getElementById('refresh-barcode');
        const requestNewBarcodeBtn = document.getElementById('request-new-barcode');
        const retryBarcodeBtn = document.getElementById('retry-barcode');
        const copyBarcodeBtn = document.getElementById('copy-barcode');

        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´
        let currentUserInfo = null;

        // ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸
        let countdownTimer = null;
        
        // ì„¸ì…˜ ì²´í¬ íƒ€ì´ë¨¸
        let sessionCheckTimer = null;
        
        // ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ íƒ€ì´ë¨¸
        let refreshScheduleTimer = null;

        // ë¡œê·¸ì¸ ë³´ì•ˆ (ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© ë°©ì§€)
        let loginAttempts = 0;
        let loginBlocked = false;
        const MAX_LOGIN_ATTEMPTS = 3;
        const LOCKOUT_TIME = 15 * 60 * 1000; // 15ë¶„

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // PWA ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ ì„±ê³µ:', registration);
                    })
                    .catch(error => {
                        console.log('ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            }
            
            // PWA ì„¤ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ê°ì§€');
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('install-pwa').style.display = 'inline-block';
            });
            
            // iOS Safari ê°ì§€ ë° ì„¤ì¹˜ ì•ˆë‚´
            function isIOS() {
                return /iPad|iPhone|iPod/.test(navigator.userAgent);
            }
            
            function isInStandaloneMode() {
                return window.matchMedia('(display-mode: standalone)').matches || 
                       window.navigator.standalone === true;
            }
            
            // iOSì—ì„œ PWAê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì€ ê²½ìš° ì•ˆë‚´
            if (isIOS() && !isInStandaloneMode()) {
                setTimeout(() => {
                    const installBtn = document.getElementById('install-pwa');
                    installBtn.style.display = 'inline-block';
                    installBtn.textContent = 'ğŸ iOS ì„¤ì¹˜';
                    installBtn.onclick = showIOSInstallGuide;
                }, 3000); // 3ì´ˆ í›„ í‘œì‹œ
            }
            
            // ì•±ì´ ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš°
            window.addEventListener('appinstalled', () => {
                console.log('PWA ì•± ì„¤ì¹˜ ì™„ë£Œ');
                document.getElementById('install-pwa').style.display = 'none';
                deferredPrompt = null;
                showSuccess('ìš°ë¦¬ì§‘ë°”ì½”ë“œ ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤! í™ˆí™”ë©´ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
            });
            
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ í™•ì¸
            const savedUser = sessionStorage.getItem('user_session');
            
            if (savedUser) {
                const session = JSON.parse(savedUser);
                
                // ì„¸ì…˜ ë§Œë£Œ ì²´í¬
                if (Date.now() < session.expiresAt) {
                    currentUserInfo = session;
                    showBarcodeSection();
                } else {
                    // ë§Œë£Œëœ ì„¸ì…˜ ì •ë¦¬
                    sessionStorage.removeItem('user_session');
                    showLoginSection();
                }
            } else {
                showLoginSection();
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            refreshBarcodeBtn.addEventListener('click', loadBarcodeFromDatabase);
            requestNewBarcodeBtn.addEventListener('click', handleRequestNewBarcode);
            retryBarcodeBtn.addEventListener('click', loadBarcodeFromDatabase);
            copyBarcodeBtn.addEventListener('click', copyBarcodeNumber);
            closeErrorBtn.addEventListener('click', hideError);
            
            // PWA ì„¤ì¹˜ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('install-pwa').addEventListener('click', installPWA);
        });

        // ì„¸ì…˜ ìœ íš¨ì„± ì²´í¬ í•¨ìˆ˜
        function checkSessionValidity() {
            const savedUser = sessionStorage.getItem('user_session');
            
            if (savedUser && currentUserInfo) {
                const session = JSON.parse(savedUser);
                
                if (Date.now() >= session.expiresAt) {
                    // ì„¸ì…˜ ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
                    showError('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    handleLogout();
                }
            }
        }

        // ì„¸ì…˜ ìë™ ì²´í¬ ì‹œì‘
        function startSessionCheck() {
            // ê¸°ì¡´ íƒ€ì´ë¨¸ ì •ë¦¬
            if (sessionCheckTimer) {
                clearInterval(sessionCheckTimer);
            }
            
            // 1ë¶„ë§ˆë‹¤ ì„¸ì…˜ ì²´í¬
            sessionCheckTimer = setInterval(checkSessionValidity, 60000);
        }

        // ì„¸ì…˜ ìë™ ì²´í¬ ì¤‘ë‹¨
        function stopSessionCheck() {
            if (sessionCheckTimer) {
                clearInterval(sessionCheckTimer);
                sessionCheckTimer = null;
            }
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬ (Edge Function ì‚¬ìš©)
        async function handleLogin(e) {
            e.preventDefault();
            
            // ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© ë°©ì§€ ì²´í¬
            if (loginBlocked) {
                showError('ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ë¡œ ì¸í•´ 15ë¶„ê°„ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const username = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showError('ì‚¬ìš©ì IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                // Edge Functionì„ í†µí•œ ì¸ì¦ (ì„œë²„ì‚¬ì´ë“œì—ì„œ í•´ì‹± ë° ê²€ì¦ ì²˜ë¦¬)
                const { data, error } = await supabase.functions.invoke('auth', {
                    body: {
                        username: username,
                        password: password
                    }
                });
                
                if (error) throw error;
                
                if (data?.success) {
                    // ì¸ì¦ ì„±ê³µ
                    loginAttempts = 0;
                    currentUserInfo = { 
                        username: data.user.username,
                        loginTime: Date.now(),
                        expiresAt: Date.now() + (30 * 60 * 1000) // 30ë¶„ ë§Œë£Œ
                    };
                    sessionStorage.setItem('user_session', JSON.stringify(currentUserInfo));
                    showBarcodeSection();
                } else {
                    // ì¸ì¦ ì‹¤íŒ¨
                    loginAttempts++;
                    if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                        loginBlocked = true;
                        setTimeout(() => {
                            loginBlocked = false;
                            loginAttempts = 0;
                        }, LOCKOUT_TIME);
                        showError(`ë¡œê·¸ì¸ ì‹¤íŒ¨. ${MAX_LOGIN_ATTEMPTS}íšŒ ì‹¤íŒ¨ë¡œ 15ë¶„ê°„ ì°¨ë‹¨ë©ë‹ˆë‹¤.`);
                    } else {
                        showError(`ë¡œê·¸ì¸ ì‹¤íŒ¨. ${MAX_LOGIN_ATTEMPTS - loginAttempts}íšŒ ë‚¨ìŒ.`);
                    }
                }
                
            } catch (error) {
                console.error('Login error:', error);
                showError('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            currentUserInfo = null;
            sessionStorage.removeItem('user_session');
            
            // ëª¨ë“  íƒ€ì´ë¨¸ ì •ë¦¬
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
            
            // ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ ì¤‘ì§€
            stopAutoRefreshSchedule();
            
            // ì„¸ì…˜ ì²´í¬ ì¤‘ë‹¨
            stopSessionCheck();
            
            showLoginSection();
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ
        function showLoginSection() {
            loginSection.style.display = 'block';
            barcodeSection.style.display = 'none';
        }

        // ë°”ì½”ë“œ ì„¹ì…˜ í‘œì‹œ
        function showBarcodeSection() {
            loginSection.style.display = 'none';
            barcodeSection.style.display = 'block';
            userIdSpan.textContent = currentUserInfo.username;
            
            // ì„¸ì…˜ ìë™ ì²´í¬ ì‹œì‘
            startSessionCheck();
            
            // ë°”ì½”ë“œ ë¡œë“œ (ìµœì´ˆ ë¡œê·¸ì¸ í”Œë˜ê·¸ ì„¤ì •)
            loadBarcodeFromDatabase(true);
        }

        // Edge Functionì„ í†µí•œ ë°”ì½”ë“œ ë°ì´í„° ë¡œë“œ
        async function loadBarcodeFromDatabase(isInitialLogin = false, isAutoRefresh = false) {
            showLoading();
            
            try {
                // Edge Functionì„ í†µí•œ ë°”ì½”ë“œ ì¡°íšŒ
                const { data, error } = await supabase.functions.invoke('get-barcode', {
                    body: {}
                });
                
                if (error) throw error;
                
                if (data?.success && data?.data) {
                    // Edge Functionì´ ë°°ì—´ë¡œ ë°˜í™˜í•˜ë¯€ë¡œ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ì‚¬ìš©
                    const barcodeData = Array.isArray(data.data) ? data.data[0] : data.data;
                    displayBarcode(barcodeData, isInitialLogin, isAutoRefresh);
                } else {
                    showNoBarcode();
                }
            } catch (error) {
                console.error('Barcode load error:', error);
                showError('ë°”ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ì„ ì‹œë„í•´ì£¼ì„¸ìš”.');
                showNoBarcode();
            }
        }

        // ë°”ì½”ë“œ í‘œì‹œ
        function displayBarcode(barcode, isInitialLogin = false, isAutoRefresh = false) {
            console.log('Received barcode data:', barcode);
            // ê¸°ì¡´ ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ ì •ë¦¬
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
            
            // ìƒˆ ë°”ì½”ë“œ ìš”ì²­ ë²„íŠ¼ ì´ˆê¸°ì— ìˆ¨ê¹€
            requestNewBarcodeBtn.style.display = 'none';
            
            // ë°”ì½”ë“œ ì´ë¯¸ì§€
            if (barcode.barcode_image_url) {
                barcodeImage.src = barcode.barcode_image_url;
                barcodeImage.style.display = 'block';
            } else {
                barcodeImage.style.display = 'none';
            }
            
            // ë°”ì½”ë“œ ë²ˆí˜¸ (í¬ë§·íŒ…)
            const formattedNumber = formatBarcodeNumber(barcode.barcode_data);
            barcodeNumberDisplay.textContent = formattedNumber;
            
            // ë§Œë£Œ ì—¬ë¶€ í™•ì¸
            const now = new Date().getTime();
            const expiresAt = barcode.expires_at ? new Date(barcode.expires_at).getTime() : null;
            const isExpired = !expiresAt || now >= expiresAt;
            
            // ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì— ë§Œë£Œë˜ì§€ ì•Šì€ ë°”ì½”ë“œë¥¼ ë°›ì•„ì˜¤ë©´ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
            if (isAutoRefresh && !isExpired) {
                console.log('ë§Œë£Œë˜ì§€ ì•Šì€ ë°”ì½”ë“œ ê°ì§€ - ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ ì¤‘ì§€');
                stopAutoRefreshSchedule();
                showSuccess('ìƒˆë¡œìš´ ë°”ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
            
            // 1. ìµœì´ˆ ë¡œê·¸ì¸ì‹œ ë§Œë£Œëœ ë°”ì½”ë“œì¼ ê²½ìš° ìë™ìœ¼ë¡œ ìƒˆ ë°”ì½”ë“œ ìš”ì²­
            if (isInitialLogin && isExpired) {
                console.log('ìµœì´ˆ ë¡œê·¸ì¸ - ë§Œë£Œëœ ë°”ì½”ë“œ ê°ì§€, ìë™ìœ¼ë¡œ ìƒˆ ë°”ì½”ë“œ ìš”ì²­');
                requestNewBarcodeAutomatically();
                return;
            }
            
            // ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            if (barcode.expires_at) {
                const expiresDate = new Date(barcode.expires_at);
                startCountdown(expiresDate);
            } else {
                barcodeTime.style.display = 'none';
                barcodeExpires.style.display = 'none';
            }
            
            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            if (barcode.updated_at) {
                const updatedDate = new Date(barcode.updated_at);
                lastUpdatedTime.textContent = updatedDate.toLocaleString('ko-KR');
            }
            
            // ë°”ì½”ë“œ í‘œì‹œ
            hideLoading();
            barcodeDisplay.style.display = 'block';
            noBarcodeDiv.style.display = 'none';
        }

        // ë°”ì½”ë“œ ë²ˆí˜¸ í¬ë§·íŒ…
        function formatBarcodeNumber(barcodeData) {
            if (!barcodeData) return '';
            
            // 4ìë¦¬ì”© ê³µë°±ìœ¼ë¡œ êµ¬ë¶„
            return barcodeData.replace(/(\d{4})(?=\d)/g, '$1 ');
        }

        // ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
        function startCountdown(expiresDate) {
            function updateCountdown() {
                const now = new Date();
                const timeLeft = expiresDate - now;
                
                if (timeLeft <= 0) {
                    // ë§Œë£Œë¨
                    barcodeTime.textContent = 'ë§Œë£Œë¨';
                    barcodeTime.className = 'time-info expired';
                    barcodeExpires.textContent = 'ìƒˆ ë°”ì½”ë“œ í•„ìš”';
                    barcodeExpires.className = 'expires-info expired';
                    
                    // ìƒˆ ë°”ì½”ë“œ ìš”ì²­ ë²„íŠ¼ í‘œì‹œ
                    requestNewBarcodeBtn.style.display = 'inline-block';
                    
                    // íƒ€ì´ë¨¸ ì •ë¦¬
                    if (countdownTimer) {
                        clearInterval(countdownTimer);
                        countdownTimer = null;
                    }
                    
                    return;
                }
                
                // ë‚¨ì€ ì‹œê°„ ê³„ì‚° (ë¶„:ì´ˆ í˜•ì‹)
                const minutes = Math.floor(timeLeft / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                // ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                barcodeTime.textContent = `ë‚¨ì€ ì‹œê°„: ${minutes}ë¶„ ${seconds}ì´ˆ`;
                
                // ë§Œë£Œ ì‹œê°„ í‘œì‹œ
                barcodeExpires.textContent = `ë§Œë£Œ: ${expiresDate.toLocaleString('ko-KR')}`;
                
                // ê²½ê³  ìƒíƒœ ì—…ë°ì´íŠ¸
                if (timeLeft <= 60000) { // 1ë¶„ ì´í•˜
                    barcodeTime.className = 'time-info expired';
                    barcodeExpires.className = 'expires-info expired';
                } else if (timeLeft <= 300000) { // 5ë¶„ ì´í•˜
                    barcodeTime.className = 'time-info warning';
                    barcodeExpires.className = 'expires-info warning';
                } else {
                    barcodeTime.className = 'time-info';
                    barcodeExpires.className = 'expires-info';
                }
                
                // ë§Œë£Œë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œëŠ” ìƒˆ ë°”ì½”ë“œ ìš”ì²­ ë²„íŠ¼ ìˆ¨ê¹€
                requestNewBarcodeBtn.style.display = 'none';
                
                // í‘œì‹œ í™œì„±í™”
                barcodeTime.style.display = 'inline-block';
                barcodeExpires.style.display = 'inline-block';
            }
            
            // ì¦‰ì‹œ í•œë²ˆ ì‹¤í–‰
            updateCountdown();
            
            // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
            countdownTimer = setInterval(updateCountdown, 1000);
        }

        // ìƒˆ ë°”ì½”ë“œ ìš”ì²­ (Edge Function í˜¸ì¶œ) - ì‚¬ìš©ì í´ë¦­ìš©
        async function handleRequestNewBarcode(e) {
            const triggerBtn = e.target;
            
            try {
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                triggerBtn.textContent = 'ìš”ì²­ ì¤‘...';
                triggerBtn.disabled = true;

                // Supabase Edge Function í˜¸ì¶œ
                const { data, error } = await supabase.functions.invoke('collect-barcode', {
                    method: 'POST',
                });

                if (error) {
                    throw new Error(error.message);
                }

                // Edge Functionì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë¨
                showSuccess('ìƒˆ ë°”ì½”ë“œ ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œìš´ ë°”ì½”ë“œê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.');
                
                // 2. ìƒˆë°”ì½”ë“œ ìš”ì²­ì´ ë˜ì—ˆì„ ê²½ìš° ìƒˆë°”ì½”ë“œ ìš”ì²­ ë²„íŠ¼ì€ ìˆ¨ê¹€ ì²˜ë¦¬
                triggerBtn.style.display = 'none';
                
                // 3, 4. ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ë§ ì‹œì‘
                startAutoRefreshSchedule();
                
            } catch (error) {
                console.error('Request new barcode error:', error);
                showError('ìƒˆ ë°”ì½”ë“œ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                triggerBtn.textContent = 'ğŸ”„ ìƒˆ ë°”ì½”ë“œ ìš”ì²­';
                triggerBtn.disabled = false;
            }
        }

        // ìë™ ìƒˆ ë°”ì½”ë“œ ìš”ì²­ í•¨ìˆ˜ (ìµœì´ˆ ë¡œê·¸ì¸ì‹œ ë§Œë£Œëœ ê²½ìš°)
        async function requestNewBarcodeAutomatically() {
            try {
                console.log('ìë™ ìƒˆ ë°”ì½”ë“œ ìš”ì²­ ì‹œì‘...');
                
                // ë¡œë”© í‘œì‹œ
                showLoading();
                showSuccess('ë§Œë£Œëœ ë°”ì½”ë“œê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë°”ì½”ë“œë¥¼ ìš”ì²­ ì¤‘...');

                // Supabase Edge Function í˜¸ì¶œ
                const { data, error } = await supabase.functions.invoke('collect-barcode', {
                    method: 'POST',
                });

                if (error) {
                    throw new Error(error.message);
                }

                // Edge Functionì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë¨
                showSuccess('ìƒˆ ë°”ì½”ë“œ ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œìš´ ë°”ì½”ë“œê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.');
                
                // 2. ìƒˆë°”ì½”ë“œ ìš”ì²­ì´ ë˜ì—ˆì„ ê²½ìš° ìƒˆë°”ì½”ë“œ ìš”ì²­ ë²„íŠ¼ì€ ìˆ¨ê¹€ ì²˜ë¦¬
                requestNewBarcodeBtn.style.display = 'none';
                
                // 3, 4. ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ë§ ì‹œì‘
                startAutoRefreshSchedule();
                
            } catch (error) {
                console.error('Automatic request new barcode error:', error);
                showError('ìë™ ë°”ì½”ë“œ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ì„ ì‹œë„í•´ì£¼ì„¸ìš”.');
                showNoBarcode();
            }
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ interval timer ì €ì¥ìš©
        let autoRefreshInterval = null;
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
        let deferredPrompt = null;
        
        // 3, 4. ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ë§ (30ì´ˆ í›„ ì‹œì‘, ì´í›„ 10ì´ˆ ê°„ê²©ìœ¼ë¡œ 4íšŒ)
        function startAutoRefreshSchedule() {
            console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ ì‹œì‘');
            
            // ê¸°ì¡´ ìŠ¤ì¼€ì¤„ íƒ€ì´ë¨¸ë“¤ ì •ë¦¬
            stopAutoRefreshSchedule();
            
            // 3. ìƒˆë°”ì½”ë“œ ìš”ì²­ì´ ë˜ì—ˆì„ ê²½ìš° ìµœì´ˆ 30ì´ˆ í›„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰
            refreshScheduleTimer = setTimeout(() => {
                console.log('30ì´ˆ í›„ ì²« ë²ˆì§¸ ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰');
                loadBarcodeFromDatabase(false, true); // ìë™ ìƒˆë¡œê³ ì¹¨ í”Œë˜ê·¸ ì„¤ì •
                
                // 4. ì´í›„ 10ì´ˆ ê°„ê²©ìœ¼ë¡œ 4íšŒ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰
                let refreshCount = 0;
                autoRefreshInterval = setInterval(() => {
                    refreshCount++;
                    console.log(`10ì´ˆ ê°„ê²© ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (${refreshCount}/4)`);
                    loadBarcodeFromDatabase(false, true); // ìë™ ìƒˆë¡œê³ ì¹¨ í”Œë˜ê·¸ ì„¤ì •
                    
                    if (refreshCount >= 4) {
                        stopAutoRefreshSchedule();
                        console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ ì™„ë£Œ');
                    }
                }, 10000); // 10ì´ˆ ê°„ê²©
                
            }, 30000); // 30ì´ˆ í›„
        }
        
        // ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ ì¤‘ì§€
        function stopAutoRefreshSchedule() {
            if (refreshScheduleTimer) {
                clearTimeout(refreshScheduleTimer);
                refreshScheduleTimer = null;
            }
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
            
            console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ìŠ¤ì¼€ì¤„ ì¤‘ì§€');
        }

        // ë°”ì½”ë“œ ë²ˆí˜¸ ë³µì‚¬
        async function copyBarcodeNumber() {
            try {
                const barcodeText = barcodeNumberDisplay.textContent;
                await navigator.clipboard.writeText(barcodeText);
                
                // ë³µì‚¬ ì™„ë£Œ í”¼ë“œë°±
                const originalText = copyBarcodeBtn.textContent;
                copyBarcodeBtn.textContent = 'ë³µì‚¬ë¨!';
                setTimeout(() => {
                    copyBarcodeBtn.textContent = originalText;
                }, 2000);
            } catch (error) {
                console.error('Copy failed:', error);
                showError('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // PWA ì„¤ì¹˜ í•¨ìˆ˜
        async function installPWA() {
            if (!deferredPrompt) {
                showError('ì•± ì„¤ì¹˜ê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤.');
                return;
            }
            
            try {
                // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
                deferredPrompt.prompt();
                
                // ì‚¬ìš©ìì˜ ì‘ë‹µ ëŒ€ê¸°
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ìŠ¹ì¸í–ˆìŠµë‹ˆë‹¤');
                    showSuccess('ì•± ì„¤ì¹˜ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤');
                }
                
                // í”„ë¡¬í”„íŠ¸ëŠ” í•œ ë²ˆë§Œ ì‚¬ìš© ê°€ëŠ¥
                deferredPrompt = null;
                document.getElementById('install-pwa').style.display = 'none';
                
            } catch (error) {
                console.error('PWA ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜:', error);
                showError('ì•± ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // iOS ì„¤ì¹˜ ì•ˆë‚´ í•¨ìˆ˜
        function showIOSInstallGuide() {
            const guideMessage = `
ğŸ“± iPhone/iPadì—ì„œ ì•± ì„¤ì¹˜ ë°©ë²•:

1. í•˜ë‹¨ ê³µìœ  ë²„íŠ¼ ğŸ“¤ í„°ì¹˜
2. "í™ˆ í™”ë©´ì— ì¶”ê°€" ì„ íƒ
3. "ì¶”ê°€" ë²„íŠ¼ í„°ì¹˜

ê·¸ëŸ¬ë©´ ìš°ë¦¬ì§‘ë°”ì½”ë“œê°€ í™ˆí™”ë©´ì— ì•±ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤!
            `.trim();
            
            // ê°„ë‹¨í•œ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì•Œë¦¼
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 30px; border-radius: 15px; 
                max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            content.innerHTML = `
                <h3 style="margin: 0 0 20px 0; color: #333;">ğŸ  ìš°ë¦¬ì§‘ë°”ì½”ë“œ ì„¤ì¹˜</h3>
                <p style="line-height: 1.6; white-space: pre-line; margin: 0 0 20px 0;">${guideMessage}</p>
                <button onclick="this.closest('.modal').remove()" 
                        style="background: #667eea; color: white; border: none; 
                               padding: 12px 24px; border-radius: 8px; cursor: pointer;">
                    í™•ì¸
                </button>
            `;
            
            modal.className = 'modal';
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸°
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            loading.style.display = 'block';
            barcodeDisplay.style.display = 'none';
            noBarcodeDiv.style.display = 'none';
        }

        // ë¡œë”© ìˆ¨ê¹€
        function hideLoading() {
            loading.style.display = 'none';
        }

        // ë°”ì½”ë“œ ì—†ìŒ í‘œì‹œ
        function showNoBarcode() {
            hideLoading();
            barcodeDisplay.style.display = 'none';
            noBarcodeDiv.style.display = 'block';
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.background = '#dc3545';
            errorMessage.style.display = 'block';
            
            // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(hideError, 5000);
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            errorText.textContent = message;
            errorMessage.style.background = '#28a745';
            errorMessage.style.display = 'block';
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(hideError, 3000);
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¹€
        function hideError() {
            errorMessage.style.display = 'none';
        }
    </script>
</body>

</html>

